{% extends "user_base.html" %}
{% load staticfiles %}
{% block bodyblock %}

    <!-- Main -->
    <section id="main" class="container">
        <header>
            <h2>Welcome {{ user.first_name }}!</h2>

            <p><a href="#user_calendar" class="">See your calander</a></p>
        </header>

        <!-- Form -->
        <div class="row">
            <div class="6u 12u(mobilep)">

                <section class="box">
                    <h3>Days Scheduled</h3>

                    <p>You currently have {{ number_of_events }} days scheduled.</p>

                    <div class="table-wrapper">
                        <table id="table">
                            <thead>
                            <tr>
                                <th>Date</th>
                                <th>Office</th>
                                <th>Rate</th>
                            </tr>
                            </thead>
                            <tbody id="table">
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <div class="6u 12u(mobilep)">
                <section class="box">
                    <h3>Days Available</h3>

                    <p>You are currently available for {{ days_available }} days.<a href="#user_calendar" class=""> Add
                        More</a></p>

                    <div class="table-wrapper">
                        <table id="available_table">
                            <thead>
                            <tr>
                                <th>&nbsp;</th>
                                <th></th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody id="availability_body">
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </div>
    </section>
    <A name="user_calendar"></A>
    <section class="container">
        <section class="box">
            <h3>What days are you available?</h3>
            <div ng-app="myApp">
                <div ng-controller="demoController">
                    <multiple-date-picker sunday-first-day="true" days-selected="{{ cal_days_selected|safe }}"
                                          day-click="dayClick"/>
                </div>
                {#<form method="post" action="/add_date/">#}
                {#<input id="date_available" name="date_available"><input type="submit">#}
                {#{% csrf_token %}#}
                {#</form>#}
            </div>
        </section>
    </section>
{#    ///*This next script is to place the info into the left side table.(Days scheduled)*///#}
    <script>
        var event_output = {{ event_output|safe }};
        var table = document.getElementById("table");
        function addRow(object) {
            var row = document.createElement("tr");
            row.innerHTML = "<td>" + object.date
            + "</td><td>" + object.office_name + "</td>";
{#            + "</td><td>" + object.rate + "</td>";#}
            table.appendChild(row);
        }
        for (var i = 0; i < event_output.length; i++) {
            var da = event_output[i];
            console.log(da);
            var d = new Date(da.date);
            addRow({"date": d.toLocaleDateString(), "office_name": da.office_name});
        }
{#        addRow({name: "Bob", day: "12.11.15", rate: 123})#}
    </script>


{#Availability Table#}
    <script>
        var dates_available = {{ days_selected|safe }};

        var available_table = document.getElementById("availability_body");
        function add_available_row(object) {
            var row = document.createElement("tr");
            row.innerHTML = "<td colspan=2>" + object.date
            + "</td><td>" + "<span onclick='remove_date(this,\"" + object.date + "\", " + object.id + ")' >Remove</span>";
            available_table.appendChild(row);

        }
        function remove_date(element, date, id) {
            element.parentElement.parentElement.remove();
            console.log(element.parentElement.parentElement.children[0]);
            console.log(date);
            console.log(id);

            var formData = new FormData();
            formData.append("id", id);
            console.log(formData)

            var request = new XMLHttpRequest();
            console.log(formData)

            request.open("POST", "/remove_date_by_id/");
            request.send(formData);

        }
        for (var i = 0; i < dates_available.length; i++) {
            var da = dates_available[i];
            console.log(da);
            var ts = parseInt(da.timestamp);
            var d = new Date(ts);
            add_available_row({"id": da.id, "date": d.toLocaleDateString()});
        }
    </script>

{% endblock %}